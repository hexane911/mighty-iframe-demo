!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mightyIframeIntegration=t():e.mightyIframeIntegration=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{authorizePackage:()=>o});class n{constructor(e,t,n){this.theme=t||"dark",this.logoSrc=e||"",this.loaderStyleId="partner-loader-style",this.loaderId="partner-loader",this.pageMode=n||!1}addStyles(){if(document.querySelector(`#${this.loaderStyleId}`))return;const e=document.createElement("style");e.id=this.loaderStyleId,e.textContent=`\n           #${this.loaderId}.container {\n  position: ${this.pageMode?"fixed":"absolute"};\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2000;\n  overflow: hidden;\n\n  background: radial-gradient(\n        134.84% 202.54% at 99.3% 0%,\n        rgba(98, 126, 234, 0.3) 3%,\n        rgba(0, 0, 0, 0.02) 130%), #1c1d26;\n}\n\n#${this.loaderId}.container.light {\n  background: #fff;\n}\n\n#${this.loaderId}.container * {\n  box-sizing: border-box;\n}\n\n#${this.loaderId}.container.closing {\n    opacity: 0; \n    animation: closing 0.3s;\n}\n\n#${this.loaderId} .center-positioned {\n  top: 50%;\n  left: 50%;\n  translate: -50% -50%;\n  position: absolute;\n}\n\n#${this.loaderId} .animation {\n  position: absolute;\n  border-radius: 50%;\n  z-index: 2022;\n  display: flex;\n  justify-content: center;\n  width: 200px;\n  height: 200px;\n}\n\n#${this.loaderId} .logo-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  background: white;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n  overflow: hidden;\n}\n\n#${this.loaderId} .logo-container.playing {\n  animation: logoBoxAnim 2s ease-in-out infinite;\n}\n\n@keyframes logoBoxAnim {\n  0% {\n    scale: 1;\n  }\n  35%,\n  50% {\n    scale: 0.8;\n  }\n  75% {\n    scale: 1.15;\n  }\n  85%,\n  100% {\n    transition-timing-function: ease-in;\n    scale: 1;\n  }\n}\n\n#${this.loaderId} .partner-logo {\n  object-fit: cover;\n  max-width: 100%;\n  max-height: 100%;\n  min-height: 100%;\n  padding: none !important;\n}\n\n#${this.loaderId} .bg-round {\n  border-radius: 50%;\n  border: solid #ffffff10;\n  z-index: 2002;\n  width: 240px;\n  height: 240px;\n  border-width: 34px;\n}\n\n#${this.loaderId} .bg-round.playing {\n  animation: borderBoxAnim 2s ease infinite;\n}\n\n@keyframes borderBoxAnim {\n  0% {\n    scale: 1;\n  }\n  40%,\n  50% {\n    scale: 1.2;\n  }\n  80% {\n    scale: 0.9;\n  }\n  87% {\n    scale: 1.08;\n  }\n  100% {\n    scale: 1;\n  }\n}\n\n@property --fill-rad {\n  syntax: "<angle>";\n  inherits: false;\n  initial-value: 0deg;\n}\n\n#${this.loaderId} .arc {\n  --b: 10px; /* the boder thickness */\n  --fill-rad: 0deg; /* control the progression */\n  opacity: 0.3;\n  width: 200px;\n  aspect-ratio: 1;\n  padding: var(--b);\n  box-sizing: border-box;\n  border-radius: 50%;\n  background: linear-gradient(#ffffff4d, #ffffff4d);\n  --_g: /var(--b) var(--b) no-repeat radial-gradient(50% 50%, #000\n        calc(100% - 1px), #0000);\n  mask: top var(--_g),\n    calc(50% + 50% * sin(var(--fill-rad)))\n      calc(50% - 50% * cos(var(--fill-rad))) var(--_g),\n    linear-gradient(#0000 0 0) content-box intersect,\n    conic-gradient(#000 var(--fill-rad), #0000 0);\n}\n\n#${this.loaderId} .arc-white {\n  --b: 4px; /* the boder thickness */\n  background: linear-gradient(#fff, #fff) !important;\n}\n\n#${this.loaderId} .arc.light {\n  background: linear-gradient(#1111114d, #1111114d);\n}\n\n#${this.loaderId} .arc-white.light {\n  background: linear-gradient(#111, #111) !important;\n}\n\n#${this.loaderId} .border-box {\n  width: 145%;\n  height: 145%;\n}\n\n#${this.loaderId} .border-thick {\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n}\n\n#${this.loaderId} .border-thin {\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  z-index: 2003;\n}\n\n#${this.loaderId} .border-thin.playing {\n  animation: borderAnimation 2s ease infinite;\n  scale: -0.98 0.98;\n}\n\n#${this.loaderId} .border-thick.playing {\n  animation: borderAnimation 2s ease infinite;\n  scale: -1 1;\n}\n\n#${this.loaderId} .second.playing {\n  animation-name: secondBorderAnimation !important;\n}\n\n#${this.loaderId} .third.playing {\n  animation-name: thirdBorderAnimation  !important ;\n}\n\n@keyframes borderAnimation {\n  0% {\n    --fill-rad: 0deg;\n    rotate: 0deg;\n    opacity: 1;\n  }\n  50% {\n    --fill-rad: 240deg;\n  }\n  \n  70% {\n    transition-timing-function: ease;\n    --fill-rad: 0deg;\n    opacity: 1;\n\n\n  }\n  80% {\n    rotate: 745deg;\n  }\n  82%,\n  100% {\n    opacity: 0;\n  }\n}\n\n@keyframes secondBorderAnimation {\n  0% {\n    --fill-rad: 0deg;\n    rotate: 0deg;\n    opacity: 0;\n  }\n  40% {\n    opacity: 0;\n  }\n  50% {\n    --fill-rad: 220deg;\n  }\n  70% {\n    opacity: 1;\n\n    transition-timing-function: ease;\n    --fill-rad: 0deg;\n\n  }\n  80% {\n    rotate: 725deg;\n  }\n  82%,\n  100% {\n    opacity: 0;\n  }\n}\n\n@keyframes thirdBorderAnimation {\n  0% {\n    --fill-rad: 0deg;\n    rotate: 0deg;\n    opacity: 0;\n  }\n  40% {\n    opacity: 0;\n  }\n  50% {\n    --fill-rad: 200deg;\n  }\n  70% {\n    opacity: 1;\n\n    transition-timing-function: ease;\n    --fill-rad: 0deg;\n\n  }\n  80% {\n    rotate: 705deg;\n  }\n  82%,\n  100% {\n    opacity: 0;\n  }\n}\n\n@keyframes closing {\n    from {\n        opacity: 1;\n    }\n    to {\n        opacity: 0;\n    }\n}\n`,document.head.appendChild(e)}closeLoader(e){e.addEventListener("animationend",(()=>{e.remove()})),e.classList.add("closing")}showLoader(){const e=document.querySelector(this.pageMode?"mighty-page":"#frame-box");if(document.getElementById(this.loaderId))return;if(!e)return;const t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("img"),d=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),h=document.createElement("div"),c=document.createElement("div"),g=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div");t.classList.add("container",this.theme),t.setAttribute("id",this.loaderId),n.classList.add("animation","center-positioned"),i.classList.add("logo-container","playing"),r.classList.add("partner-logo"),d.classList.add("bg-round","center-positioned","playing"),a.classList.add("border-box","center-positioned"),s.classList.add("border-box","center-positioned"),o.classList.add("border-box","center-positioned"),l.classList.add("border-thick","center-positioned","arc","playing",this.theme),h.classList.add("border-thick","center-positioned","arc","playing",this.theme,"second"),c.classList.add("border-thick","center-positioned","arc","playing",this.theme,"third"),g.classList.add("border-thin","center-positioned","arc","arc-white","playing",this.theme),p.classList.add("border-thin","center-positioned","arc","arc-white","playing",this.theme,"second"),m.classList.add("border-thin","center-positioned","arc","arc-white","playing",this.theme,"third"),a.appendChild(l),a.appendChild(g),s.appendChild(h),s.appendChild(p),o.appendChild(c),o.appendChild(m),d.appendChild(a),d.appendChild(s),d.appendChild(o),r.setAttribute("src",this.logoSrc),i.appendChild(r),n.appendChild(i),t.appendChild(d),t.appendChild(n),this.addStyles(),e.appendChild(t),this.checkForLoadingEnd(t)}checkForLoadingEnd(e){window.addEventListener("message",(t=>{"loaded"===t.data&&this.closeLoader(e)}))}}class i{constructor(){this.currentSidebar=null,this.initializedTriggers=new Map,this.setTriggers=new Set,this.mightySidebarId="mighty-course-sidebar",this.mightyStyleId="mighty-sidebar-styles",this.baseUrl="http://test.mighty.study",this.partnerKey="099d94c60458dd7429e95eaca9cb622c9246a17a7e35d8859284051c48b3fd11",this.sidebarMapTriggers={},this.logoSrc="",this.addStyles(),this.initObserverWhenReady(),console.log(l())}addStyles(){if(document.querySelector(`#${this.mightyStyleId}`))return;console.log(l());const e=document.createElement("style");e.id=this.mightyStyleId,e.textContent=`\n      #${this.mightySidebarId} {\n        position: fixed;\n        top: 0;\n        right: 0;\n        transform: translateX(100%);\n        width: var(--mighty-expanded-width);\n        height: 100%;\n        color: #AFB4B8;\n        background: radial-gradient(100% 60% at 100% 100%, rgba(98, 126, 234, 0.2) 0%, rgba(0, 0, 0, 0.02) 97.05%), rgb(28, 29, 38);\n        z-index: 1000;\n        display: flex;\n        flex-direction: column;\n        transition: transform 0.3s ease, width 0.3s ease, height 0.3s ease;\n      }\n\n      #${this.mightySidebarId}.light {\n        background: radial-gradient(73.04% 270.4% at 142.59% 81.5%, rgba(98, 126, 234, 0.2) 0%, rgba(0, 0, 0, 0.02) 97.05%), rgb(255, 255, 255);;\n        color: #111111;\n      }\n\n\n      #${this.mightySidebarId}.light div {\n        color: #111111;\n      }\n\n      #${this.mightySidebarId}.mighty-sidebar-expanded {\n        width: 100%;\n      }\n\n      #${this.mightySidebarId}.mighty-sidebar-expanded .mighty-button-close {\n        opacity: 0;\n        pointer-events: none;\n      }\n\n      #${this.mightySidebarId}.mighty-sidebar-open {\n        transform: translateX(0);\n      }\n\n      #${this.mightySidebarId} .mighty-header-sidebar {\n        display: flex;\n        justify-content: flex-start;\n        align-items: center;\n        padding: 10px;\n      }\n      #${this.mightySidebarId} .mighty-sidebar-button {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 32px;\n        height: 32px;\n        border-radius: 5px;\n        color: rgba(255, 255, 255, 0.4);\n        transition: all 0.3s ease;\n        cursor: pointer;\n        background: transparent;\n      }\n      #${this.mightySidebarId} .mighty-sidebar-button:hover {\n        background: rgba(255, 255, 255, 0.15);\n      }\n      #${this.mightySidebarId} .frame-box {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n      #${this.mightySidebarId} iframe {\n        width: 100%;\n        height: 100%;\n        border: none;\n      }\n     @media (max-width: 992px) {\n        #${this.mightySidebarId} {\n          top: auto;\n          bottom: 0;\n          transform: translateY(100%);\n          width: 100%;\n          height: 80%;\n          right: 0;\n          border-radius: 20px 20px 0 0;\n        }\n        #${this.mightySidebarId}.mighty-sidebar-open {\n          transform: translateY(0);\n        }\n        #${this.mightySidebarId}.mighty-sidebar-expanded {\n          height: 100%;\n        }\n      }\n    `,document.head.appendChild(e)}createSidebar(e){document.documentElement.style.setProperty("--mighty-expanded-width",this.percent);const t=document.createElement("div");t.id=this.mightySidebarId;const n=document.createElement("div"),i=document.createElement("div");n.classList.add("mighty-header-sidebar"),n.style.display="flex",n.style.justifyContent="flex-start",n.style.alignItems="center",n.style.padding="10px",i.classList.add("frame-box"),i.setAttribute("id","frame-box");const r=(e,t,n)=>{const i=document.createElement("div");return i.innerHTML=e,i.classList.add("mighty-sidebar-button"),n&&i.classList.add(n),i.onclick=t,i},d=r('<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 14.6654L7.66667 7.9987L1 1.33203M10.3333 14.6654L17 7.9987L10.3333 1.33203" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>',(()=>{this.closeSidebar(t)}),"mighty-button-close");let a=!1;const s=r('<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7852 15.3131L8.71817 9.24609M8.71817 9.24609L8.71817 15.3131M8.71817 9.24609L14.7852 9.24609" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M17.2148 17.7383L23.2818 23.8053M23.2818 23.8053V17.7383M23.2818 23.8053H17.2148" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>',(()=>{a=!a,t.classList.toggle("mighty-sidebar-expanded")}));n.appendChild(s),n.appendChild(d),t.appendChild(n);const o=document.createElement("iframe");return i.appendChild(o),t.appendChild(i),{sidebar:t,iframe:o}}closeSidebar(e){return new Promise((t=>{e.classList.contains("mighty-sidebar-expanded")?(e.classList.remove("mighty-sidebar-expanded"),setTimeout((()=>{e.classList.remove("mighty-sidebar-open"),setTimeout((()=>{document.querySelector(`#${this.mightySidebarId}`)&&document.body.removeChild(document.querySelector(`#${this.mightySidebarId}`)),this.currentSidebar=null,t()}),300)}),300)):(e.classList.remove("mighty-sidebar-open"),setTimeout((()=>{document.querySelector(`#${this.mightySidebarId}`)&&document.body.removeChild(document.querySelector(`#${this.mightySidebarId}`)),this.currentSidebar=null,t()}),300))}))}openSidebar(e,t,n,i,r){this.currentSidebar?this.closeSidebar(this.currentSidebar).then((()=>{this.createAndOpenSidebar(e,t,n,i,r)})):this.createAndOpenSidebar(e,t,n,i,r)}createAndOpenSidebar(e,t=null,i=null,r,d=""){this.percent=r||"40%";const{sidebar:a,iframe:s}=this.createSidebar(r),o=null!==t&&null!==t?.courseId,h=null==i?l():i,c=h?`&theme=${h}`:"&";let g=`${this.baseUrl}/space/${e}?partnerID=${e}&partnerToken=${this.partnerKey}${c}`;o&&(g=`${this.baseUrl}/courses/${t.courseId}`,null!==t.chapterId&&(g+=`/${t.chapterId}`),null!==t.lessonId&&(g+=`/${t.lessonId}`),g+=`?partnerID=${e}&partnerToken=${this.partnerKey}${c}`),s.src=g,document.body.appendChild(a),setTimeout((()=>{a.classList.add("mighty-sidebar-open"),i&&a.classList.add(i)}),10),this.currentSidebar=a,new n(d,i).showLoader()}parseCourseFromUrl(e){if(!e)return null;const t=e.indexOf("/courses/");if(-1===t)return null;const n=e.slice(t+9).split("/").filter(Boolean),i={courseId:null,chapterId:null,lessonId:null};return n.length>=3?(i.lessonId=n[n.length-1],i.chapterId=n[n.length-2],i.courseId=n[n.length-3]):2===n.length?(i.chapterId=n[n.length-1],i.courseId=n[n.length-2]):1===n.length&&(i.courseId=n[n.length-1]),i.courseId||i.chapterId||i.lessonId?i:null}initSidebar(e,t,n,i,r,d){if(!a)return void console.error("Package not authorized. Please provide a valid partnerId.");console.log({selector:e,percentW:r}),console.log(this.sidebarMapTriggers[e]);const s=r||null,o=document.querySelector(e);if(this.setTriggers.add(e),this.sidebarMapTriggers[e]={course:n,theme:i,partnerId:t,percent:s},o){if(this.initializedTriggers.has(e)){const{handler:t}=this.initializedTriggers.get(e);o.removeEventListener("click",t)}const r=()=>{this.openSidebar(t,n,i,s,d)};o.addEventListener("click",r),this.initializedTriggers.set(e,{element:o,handler:r,partnerId:t,course:n,theme:i,percent:s,logoSrc:d})}else console.error(`Element with selector "${e}" not found.`)}initObserverWhenReady(){document.body?this.observeDOM():document.addEventListener("DOMContentLoaded",(()=>this.observeDOM()))}observeDOM(){new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&(e.removedNodes.forEach((e=>{1===e.nodeType&&this.removeTrigger(e)})),e.addedNodes.forEach((e=>{1===e.nodeType&&this.reinitializeTriggers(e)})))}))})).observe(document.body,{childList:!0,subtree:!0})}removeTrigger(e){this.initializedTriggers.forEach(((t,n)=>{(t.element===e||e.contains(t.element))&&(t.element.removeEventListener("click",t.handler),this.initializedTriggers.delete(n))}))}reinitializeTriggers(e){this.setTriggers.forEach(((t,n)=>{(e.matches(n)||e.querySelector(n))&&this.initSidebar(n,this.sidebarMapTriggers[n].partnerId,this.sidebarMapTriggers[n].course,this.sidebarMapTriggers[n].theme,this.sidebarMapTriggers[n].percent,this.sidebarMapTriggers[n].logoSrc)}))}}class r extends HTMLElement{static get observedAttributes(){return["partnerid","targeturl","percent","theme","logoSrc"]}constructor(){super(),this.partnerId=this.getAttribute("partnerid")||null,this.targetUrl=this.getAttribute("targeturl")||null,this.percent=this.getAttribute("percent")||"40%",this.theme=this.getAttribute("theme")||l(),this.logoSrc=this.getAttribute("logoSrc")||"",this.sidebarInstance=window.mightySidebar,console.log("render mighty widget")}connectedCallback(){this.updateAttributes();const e=this.firstElementChild;e&&e.addEventListener("click",this.handleClick.bind(this))}disconnectedCallback(){const e=this.firstElementChild;e&&e.removeEventListener("click",this.handleClick.bind(this))}attributeChangedCallback(e,t,n){t!==n&&this.updateAttributes()}updateAttributes(){this.partnerId=this.getAttribute("partnerid")||null,this.targetUrl=this.getAttribute("targeturl")||null,this.percent=this.getAttribute("percent")||"40%",this.theme=this.getAttribute("theme")||l(),this.logoSrc=this.getAttribute("logoSrc")||""}handleClick(){if(this.updateAttributes(),!this.partnerId)return void console.error("partnerId is not defined");this.sidebarInstance||(this.sidebarInstance=new i);const e=this.sidebarInstance.parseCourseFromUrl(this.targetUrl);this.sidebarInstance.openSidebar(this.partnerId,e,this.theme,this.percent,this.logoSrc)}}class d extends HTMLElement{constructor(){super(),this.partnerId=this.getAttribute("partnerid")||null,this.targetUrl=this.getAttribute("targeturl")||null,this.theme=this.getAttribute("theme")||l(),this.logoSrc=this.getAttribute("logoSrc")||"",this.iframe=null,this.baseUrl="https://test.mighty.study",this.partnerKey="099d94c60458dd7429e95eaca9cb622c9246a17a7e35d8859284051c48b3fd11",this.sidebarInstance=window.mightySidebar}static get observedAttributes(){return["partnerid","targeturl","theme"]}connectedCallback(){this.renderIframe(),this.style.width="100%",this.style.height="100vh",this.style.display="block"}attributeChangedCallback(e,t,n){t!==n&&this.renderIframe()}renderIframe(){this.iframe&&this.removeChild(this.iframe);const e=this.getAttribute("partnerid"),t=this.getAttribute("targeturl"),i=this.getAttribute("logoSrc");if(!e)return void console.error("partnerId is not defined");const r=this.getAttribute("theme")||l(),d=r?`&theme=${r}`:"&",a=document.createElement("iframe");if(a.width="100%",a.height="100%",a.style.border="none",a.style.display="block",console.log(t),t){const t=this.sidebarInstance.parseCourseFromUrl(this.targetUrl);console.log(t);const n=null!==t&&null!==t?.courseId;let i=`${this.baseUrl}/space/${e}?partnerID=${e}&partnerToken=${this.partnerKey}${d}`;n&&(i=`${this.baseUrl}/courses/${t.courseId}`,null!==t.chapterId&&(i+=`/${t.chapterId}`),null!==t.lessonId&&(i+=`/${t.lessonId}`),i+=`?partnerID=${e}&partnerToken=${this.partnerKey}${d}`),console.log(i),a.src=i}this.appendChild(a),this.iframe=a,new n(i,r,!0).showLoader()}}let a=!0,s="dark";function o(e="dark"){a=!0,s=e;const t=new i;window.initSidebar=({selector:e,partnerId:n,course:i,theme:r,percent:d})=>t.initSidebar(e,n,i,r,d),window.mightySidebar=t,customElements.get("mighty-widget")||customElements.define("mighty-widget",r),customElements.get("mighty-page")||customElements.define("mighty-page",d)}function l(){return s}return t})()));